mass-production using the USB 512-Word DFU Bootloader for PIC16(L)F1454/5/9
===========================================================================

The bootloader includes a '454hex2dfu' tool to convert the user application firmware image (Intel Hex format) into a .dfu image suitable for dfu-util (or similar DFU utility).

However, perhaps you plan to mass-produce many devices powered by the PIC16(L)F1454/5/9.  In this case, you may want the option to directly program the microcontroller with both the bootloader and your application at the same time.

This directory contains the source code for three command-line tools to help make this possible.

## ihex-add-crc14

One of the important features of the 'USB 512-Word DFU Bootloader for PIC16(L)F1454/5/9' is that it performs a CRC check of the user application before transferring execution to it.

The '454hex2dfu' tool adds this CRC automatically when creating the .dfu image.

'ihex-add-crc14' accepts the same input Intel Hex image as '454hex2dfu' does, but outputs a new Intel Hex image with the CRC added.

## ihex-merge

This tool combines:

- the bootloader Intel Hex firmware image containing the bootloader and the configuration bits used by the PIC16(L)F1454/5/9 microcontroller.

- Intel Hex firmware image representing the user application and CRC (generated by 'ihex-add-crc14')

## sqtp-numgen

Note that this step is optional.

Another important feature of the 'USB 512-Word DFU Bootloader for PIC16(L)F1454/5/9' is that it provides for an eight-character USB serial number to be written into the write-protected bootloader memory space.

Consult the README.md in the sqtp-numgen subdirectory for details, but SQTP is an optional feature provided for by Microchip that allows each microcontroller device to be programmed with a different serial number.  sqtp-numgen generates a SQTP '.num' that is accepted by Microchip's software.

## Sample Usage (Bootloader + User Application + serial number)

```
ihex-add-crc14 foo.hex foowithCRC.hex
ihex-merge bootloaderSN.hex foowithCRC.hex myProduction.hex
sqtp-numgen > mySNs.num
```

The user application can use the serial number (stored within the bootloader) even if the bootloader does not. If it is desired that the bootloader also use the serial number, the bootloader must be re-compiled with 'HIDE_SERIAL_NUMBER' set to 0.

In the above example, the factory would then use 'myProduction.hex' and 'mySNs.num' to program many PIC16(L)F1454/5/9 microcontrollers.  Each part would be pre-programmed with both the bootloader and the user application 'foo.hex'.  By using 'mySNs.num', each part would contain a different serial number.

## Sample Usage (Bootloader + User Application)

```
ihex-add-crc14 foo.hex foowithCRC.hex
ihex-merge bootloader.hex foowithCRC.hex myProduction.hex
```

In the above example, the factory would then use 'myProduction.hex' to program many PIC16(L)F1454/5/9 microcontrollers.  Each part would be pre-programmed with both the bootloader and the user application 'foo.hex'.  Omitting the SQTP '.num' file, however, means each part would be identical (e.g. different serial number are not programmed).

## Sample Usage (Bootloader + serial number)

```
sqtp-numgen > mySNs.num
```

The user application can use the serial number (stored within the bootloader) even if the bootloader does not. If it is desired that the bootloader also use the serial number, the bootloader must be re-compiled with 'HIDE_SERIAL_NUMBER' set to 0.

In the above example, the factory would then use 'bootloaderSN.hex' and 'mySNs.num' to program many PIC16(L)F1454/5/9 microcontrollers.  By using 'mySNs.num', each part would contain a different serial number.  Since there is no user application initially programmed, the devices will boot into the bootloader ready to accept a user application.

